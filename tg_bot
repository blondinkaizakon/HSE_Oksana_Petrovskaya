import logging
from telegram import Update, KeyboardButton, ReplyKeyboardMarkup, ReplyKeyboardRemove
from telegram.ext import ApplicationBuilder, CommandHandler, MessageHandler, filters, ContextTypes

# --- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è ---
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO
)
logger = logging.getLogger(__name__)

# --- –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã ---
BOT_TOKEN = "7263502491:AAEyUdhs9ibx1DfYwoE-NbzGO40tFj76Hes"  

# --- –¢–µ–∫—Å—Ç—ã ---
TEXTS = {
    "start_new": "üåü –ü—Ä–∏–≤–µ—Ç! –Ø —á–∞—Ç-–±–æ—Ç –õ–µ–≥–∞–ª–§–ª–æ—É, –∏ —è –∑–¥–µ—Å—å, —á—Ç–æ–±—ã –ø–æ–º–æ—á—å –≤–∞–º —Å —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏. –í—ã –∑–¥–µ—Å—å –≤–ø–µ—Ä–≤—ã–µ –∏–ª–∏ —É–∂–µ –∑–Ω–∞–∫–æ–º—ã —Å –Ω–∞–º–∏? –î–∞–≤–∞–π—Ç–µ –Ω–∞—á–Ω–µ–º!",
    "start_returning": "üëã –° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º! –†–∞–¥ —Å–Ω–æ–≤–∞ –ø–æ–º–æ—á—å –≤–∞–º —Å —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏. –ß–µ–º –º–æ–≥—É –±—ã—Ç—å –ø–æ–ª–µ–∑–µ–Ω?",
    "main_menu": "üìã –í—ã–±–µ—Ä–∏—Ç–µ, —á—Ç–æ –≤–∞–º –Ω—É–∂–Ω–æ:",
    "services_overview": (
        "üíº –ú—ã —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º—Å—è –Ω–∞ —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–º —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–∏ –±–∏–∑–Ω–µ—Å–∞. –í–æ—Ç –∫—Ä–∞—Ç–∫–∏–π –æ–±–∑–æ—Ä –Ω–∞—à–∏—Ö —É—Å–ª—É–≥:\n\n"
        "üîç <b>–ü—Ä–∞–≤–æ–≤–æ–π –∞—É–¥–∏—Ç:</b> –ü—Ä–æ–≤–µ—Ä–∏–º –≤–∞—à –±–∏–∑–Ω–µ—Å –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö —Ä–∏—Å–∫–æ–≤ –∏ –ø—Ä–µ–¥–ª–æ–∂–∏–º —Ä–µ—à–µ–Ω–∏—è.\n\n"
        "‚öñÔ∏è <b>–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ –≤ —Å—É–¥–∞—Ö –∏ –≥–æ—Å–æ—Ä–≥–∞–Ω–∞—Ö:</b> –ó–∞—â–∏—Ç–∏–º –≤–∞—à–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã –≤ —Å—É–¥–µ–±–Ω—ã—Ö –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä–∞—Ö.\n\n"
        "ü§ñ <b>–õ–µ–≥–∞–ª—Ç–µ–∫ —Ä–µ—à–µ–Ω–∏—è:</b> –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–¥–æ–≤—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –≤ –≤–∞—à–µ–º –±–∏–∑–Ω–µ—Å–µ.\n\n"
        "–í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É, –∫–æ—Ç–æ—Ä—É—é —Ö–æ—Ç–∏—Ç–µ —É–∑–Ω–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ, –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ \"–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è\", —á—Ç–æ–±—ã –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –±–µ—Å–ø–ª–∞—Ç–Ω—É—é –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é —Å –Ω–∞—à–∏–º —ç–∫—Å–ø–µ—Ä—Ç–æ–º!"
    ),
    "audit_details": (
        "üîç –ü—Ä–∞–≤–æ–≤–æ–π –∞—É–¥–∏—Ç ‚Äî —ç—Ç–æ –æ—Ç–ª–∏—á–Ω—ã–π —Å–ø–æ—Å–æ–± –≤—ã—è–≤–∏—Ç—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —Ä–∏—Å–∫–∏ –∏ —É–ª—É—á—à–∏—Ç—å —é—Ä–∏–¥–∏—á–µ—Å–∫—É—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤–∞—à–µ–≥–æ –±–∏–∑–Ω–µ—Å–∞. "
        "–ú—ã –ø—Ä–æ–≤–µ–¥–µ–º —Ç—â–∞—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≤–∞—à–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, –¥–æ–≥–æ–≤–æ—Ä–æ–≤ –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.\n\n"
        "üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–∞–≤–æ–≤–æ–≥–æ –∞—É–¥–∏—Ç–∞ –≤ –õ–µ–≥–∞–ª–§–ª–æ—É –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –æ—Ç 50 000 —Ä—É–±–ª–µ–π. "
        "–ì–æ—Ç–æ–≤—ã –∑–∞–∫–∞–∑–∞—Ç—å –∏–ª–∏ —Ö–æ—Ç–∏—Ç–µ –±–µ—Å–ø–ª–∞—Ç–Ω—É—é –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ? –ù–∞–ø–∏—à–∏—Ç–µ \"–ó–∞–∫–∞–∑–∞—Ç—å\" –∏–ª–∏ \"–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è\"."
    ),
    "request_status_prompt": "üî¢ –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –Ω–æ–º–µ—Ä –≤–∞—à–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –∏–ª–∏ –∫—Ä–∞—Ç–∫–æ –æ–ø–∏—à–∏—Ç–µ –µ–≥–æ, –∏ —è –ø—Ä–æ–≤–µ—Ä—é —Å—Ç–∞—Ç—É—Å –¥–ª—è –≤–∞—Å.",
    "consultation_prompt": "üìû –û—Ç–ª–∏—á–Ω—ã–π –≤—ã–±–æ—Ä! –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è –∏ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞, –∏ –º—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –¥–ª—è –∑–∞–ø–∏—Å–∏ –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é.",
    "humor_response_day": "üåû –°–µ–≥–æ–¥–Ω—è –æ—Ç–ª–∏—á–Ω—ã–π –¥–µ–Ω—å –¥–ª—è —Ä–µ—à–µ–Ω–∏—è —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤! –ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å, —è –≤—Å–µ–≥–¥–∞ –∑–¥–µ—Å—å.",
    "humor_response_pizza": "üçï –ö–æ–Ω–µ—á–Ω–æ, –º–æ–∂–Ω–æ! –ì–ª–∞–≤–Ω–æ–µ, —á—Ç–æ–±—ã —ç—Ç–æ –Ω–µ –ø—Ä–∏–≤–µ–ª–æ –∫ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–º –ø—Ä–æ–±–ª–µ–º–∞–º, —Å–≤—è–∑–∞–Ω–Ω—ã–º —Å –Ω–∞—Ä—É—à–µ–Ω–∏–µ–º –¥–∏–µ—Ç—ã. üòÑ",
    "humor_response_how_not_trouble": (
        "üõ°Ô∏è –û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å! –í–æ—Ç –≥–¥–µ –º—ã –º–æ–∂–µ–º –ø–æ–º–æ—á—å. "
        "–ù–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–∏ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö —Ä–∏—Å–∫–æ–≤. "
        "–ó–∞–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –±–µ—Å–ø–ª–∞—Ç–Ω—É—é –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é, –∏ –º—ã —Ä–∞—Å—Å–∫–∞–∂–µ–º, –∫–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å –Ω–µ–ø—Ä–∏—è—Ç–Ω–æ—Å—Ç–µ–π —Å –∑–∞–∫–æ–Ω–æ–º."
    ),
    "goodbye": "ü§ó –ï—Å–ª–∏ —É –≤–∞—Å –±–æ–ª—å—à–µ –Ω–µ—Ç –≤–æ–ø—Ä–æ—Å–æ–≤, –Ω–µ –∑–∞–±—ã–≤–∞–π—Ç–µ, —á—Ç–æ –º—ã –≤—Å–µ–≥–¥–∞ –∑–¥–µ—Å—å, —á—Ç–æ–±—ã –ø–æ–º–æ—á—å. –î–æ —Å–∫–æ—Ä–æ–π –≤—Å—Ç—Ä–µ—á–∏!",
    "special_offer": (
        "üéÅ –ö—Å—Ç–∞—Ç–∏, —É –Ω–∞—Å –µ—Å—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤: "
        "<a href='https://your-link-to-checklist.com'>—á–µ–∫-–ª–∏—Å—Ç –∫–∞–∫ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –ø—Ä–µ—Ç–µ–Ω–∑–∏—é –∑–∞ 5 —à–∞–≥–æ–≤</a>! –ù–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–µ!\n\n"
        "üìã –•–æ—Ç–∏—Ç–µ –±—ã—Ç—å –≥–æ—Ç–æ–≤—ã –∫ –ª—é–±–æ–π –ø—Ä–µ—Ç–µ–Ω–∑–∏–∏? –ù–∞—à —á–µ–∫-–ª–∏—Å—Ç –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –ø—Ä–µ—Ç–µ–Ω–∑–∏—é –±—ã—Å—Ç—Ä–æ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ. –í–æ—Ç —á—Ç–æ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ:\n\n"
        "1Ô∏è‚É£ –®–∞–≥ 1: –û—Ü–µ–Ω–∏—Ç–µ –ø—Ä–µ—Ç–µ–Ω–∑–∏—é –∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—É–Ω–∫—Ç—ã.\n"
        "2Ô∏è‚É£ –®–∞–≥ 2: –°–æ–±–µ—Ä–∏—Ç–µ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞.\n"
        "3Ô∏è‚É£ –®–∞–≥ 3: –°–æ—Å—Ç–∞–≤—å—Ç–µ –≥—Ä–∞–º–æ—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç, —Å–ª–µ–¥—É—è —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–º –Ω–æ—Ä–º–∞–º.\n"
        "4Ô∏è‚É£ –®–∞–≥ 4: –û—Ç–ø—Ä–∞–≤—å—Ç–µ –æ—Ç–≤–µ—Ç –≤ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å—Ä–æ–∫.\n"
        "5Ô∏è‚É£ –®–∞–≥ 5: –ì–æ—Ç–æ–≤—å—Ç–µ—Å—å –∫ –≤–æ–∑–º–æ–∂–Ω–æ–º—É —Å—É–¥–µ–±–Ω–æ–º—É —Ä–∞–∑–±–∏—Ä–∞—Ç–µ–ª—å—Å—Ç–≤—É."
    ),
    "unknown_command": "ü§î –ò–∑–≤–∏–Ω–∏—Ç–µ, —è –Ω–µ –ø–æ–Ω–∏–º–∞—é —ç—Ç—É –∫–æ–º–∞–Ω–¥—É. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ–Ω—é –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ \"–ú–µ–Ω—é\", —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –æ—Å–Ω–æ–≤–Ω—ã–º –æ–ø—Ü–∏—è–º.",
    "unknown_message": "ü§î –Ø –Ω–µ —Å–æ–≤—Å–µ–º –ø–æ–Ω—è–ª –≤–∞—à –∑–∞–ø—Ä–æ—Å. –ú–æ–≥—É –ª–∏ —è —á–µ–º-–Ω–∏–±—É–¥—å –ø–æ–º–æ—á—å –∏–∑ –º–µ–Ω—é?"
}

# --- –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã ---
MAIN_MENU_KEYBOARD = [
    [KeyboardButton("üíº –£–∑–Ω–∞—Ç—å –æ –Ω–∞—à–∏—Ö —É—Å–ª—É–≥–∞—Ö")],
    [KeyboardButton("üìÖ –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é")],
    [KeyboardButton("‚ùì –£–∑–Ω–∞—Ç—å –æ —Å—Ç–∞—Ç—É—Å–µ –∑–∞–ø—Ä–æ—Å–∞")],
    [KeyboardButton("üì¨ –î—Ä—É–≥–æ–µ (–Ω–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å)")],
    [KeyboardButton("üéÅ –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ")]
]

SERVICES_KEYBOARD = [
    [KeyboardButton("üîç –ü—Ä–∞–≤–æ–≤–æ–π –∞—É–¥–∏—Ç")],
    [KeyboardButton("‚öñÔ∏è –°—É–¥—ã –∏ –≥–æ—Å–æ—Ä–≥–∞–Ω—ã")],
    [KeyboardButton("ü§ñ –õ–µ–≥–∞–ª—Ç–µ–∫")],
    [KeyboardButton("üìû –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è")],
    [KeyboardButton("‚¨ÖÔ∏è –ù–∞–∑–∞–¥")]
]

BACK_KEYBOARD = [[KeyboardButton("‚¨ÖÔ∏è –ù–∞–∑–∞–¥")]]

# --- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ ---

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ."""
    user = update.effective_user
    logger.info(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user.first_name} ({user.id}) –Ω–∞—á–∞–ª –¥–∏–∞–ª–æ–≥.")
    
    # –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ "–Ω–æ–≤—ã–π/—Å—Ç–∞—Ä—ã–π" –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –±–æ—Ç–µ —ç—Ç–æ —Ö—Ä–∞–Ω–∏–ª–æ—Å—å –±—ã –≤ –ë–î)
    # –î–ª—è –ø—Ä–∏–º–µ—Ä–∞: –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –ø–∏—Å–∞–ª, —Å—á–∏—Ç–∞–µ–º –µ–≥–æ "—Å—Ç–∞—Ä—ã–º"
    if context.user_data.get("has_interacted"):
        greeting = TEXTS["start_returning"]
    else:
        greeting = TEXTS["start_new"]
        context.user_data["has_interacted"] = True

    await update.message.reply_text(
        greeting,
        reply_markup=ReplyKeyboardMarkup(MAIN_MENU_KEYBOARD, resize_keyboard=True)
    )

async def show_main_menu(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é."""
    await update.message.reply_text(
        TEXTS["main_menu"],
        reply_markup=ReplyKeyboardMarkup(MAIN_MENU_KEYBOARD, resize_keyboard=True),
        parse_mode="HTML"
    )

async def handle_services_menu(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å '–£–∑–Ω–∞—Ç—å –æ –Ω–∞—à–∏—Ö —É—Å–ª—É–≥–∞—Ö'."""
    await update.message.reply_text(
        TEXTS["services_overview"],
        reply_markup=ReplyKeyboardMarkup(SERVICES_KEYBOARD, resize_keyboard=True),
        parse_mode="HTML"
    )

async def handle_audit_details(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å '–ü—Ä–∞–≤–æ–≤–æ–π –∞—É–¥–∏—Ç'."""
    await update.message.reply_text(
        TEXTS["audit_details"],
        reply_markup=ReplyKeyboardMarkup(BACK_KEYBOARD, resize_keyboard=True),
        parse_mode="HTML"
    )

async def handle_consultation_request(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å '–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é'."""
    await update.message.reply_text(
        TEXTS["consultation_prompt"],
        reply_markup=ReplyKeyboardMarkup(BACK_KEYBOARD, resize_keyboard=True)
    )

async def handle_request_status(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å '–£–∑–Ω–∞—Ç—å –æ —Å—Ç–∞—Ç—É—Å–µ –∑–∞–ø—Ä–æ—Å–∞'."""
    await update.message.reply_text(
        TEXTS["request_status_prompt"],
        reply_markup=ReplyKeyboardMarkup(BACK_KEYBOARD, resize_keyboard=True)
    )

async def handle_special_offer(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å '–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ'."""
    await update.message.reply_text(
        TEXTS["special_offer"],
        reply_markup=ReplyKeyboardMarkup(MAIN_MENU_KEYBOARD, resize_keyboard=True),
        parse_mode="HTML",
        disable_web_page_preview=False
    )

async def handle_back(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫—É '–ù–∞–∑–∞–¥'."""
    await show_main_menu(update, context)

async def handle_other_question(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç '–î—Ä—É–≥–æ–µ (–Ω–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å)'."""
    user_question = update.message.text
    logger.info(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–¥–∞–ª –≤–æ–ø—Ä–æ—Å: {user_question}")
    # –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–æ–ø—Ä–æ—Å–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—Ç–ø—Ä–∞–≤–∫—É –≤ –≥—Ä—É–ø–ø—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏
    await update.message.reply_text(
        "üì© –°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à –≤–æ–ø—Ä–æ—Å! –ù–∞—à–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã —Å–≤—è–∂—É—Ç—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.",
        reply_markup=ReplyKeyboardMarkup(MAIN_MENU_KEYBOARD, resize_keyboard=True)
    )

async def handle_humor_or_questions(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —é–º–æ—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –∏ –æ–±—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã."""
    user_message = update.message.text.lower()

    if "–∫–∞–∫–æ–π —Å–µ–≥–æ–¥–Ω—è –¥–µ–Ω—å" in user_message or "–∫–∞–∫–æ–π –¥–µ–Ω—å" in user_message:
        response = TEXTS["humor_response_day"]
    elif "–º–æ–∂–Ω–æ –ª–∏ –µ—Å—Ç—å –ø–∏—Ü—Ü—É" in user_message or "–ø–∏—Ü—Ü–∞ –Ω–∞ –∑–∞–≤—Ç—Ä–∞–∫" in user_message:
        response = TEXTS["humor_response_pizza"]
    elif "–∫–∞–∫ –º–Ω–µ –Ω–µ –ø–æ–ø–∞—Å—Ç—å –≤ –Ω–µ–ø—Ä–∏—è—Ç–Ω–æ—Å—Ç–∏" in user_message or "–Ω–µ –ø–æ–ø–∞—Å—Ç—å –≤ –Ω–µ–ø—Ä–∏—è—Ç–Ω–æ—Å—Ç–∏" in user_message:
        response = TEXTS["humor_response_how_not_trouble"]
    else:
        response = TEXTS["unknown_message"]

    await update.message.reply_text(
        response,
        reply_markup=ReplyKeyboardMarkup(MAIN_MENU_KEYBOARD, resize_keyboard=True),
        parse_mode="HTML"
    )

async def handle_goodbye(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞."""
    await update.message.reply_text(
        TEXTS["goodbye"],
        reply_markup=ReplyKeyboardRemove()
    )

async def unknown_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã."""
    await update.message.reply_text(
        TEXTS["unknown_command"],
        reply_markup=ReplyKeyboardMarkup(MAIN_MENU_KEYBOARD, resize_keyboard=True)
    )


def main() -> None:
    """–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞."""
    application = ApplicationBuilder().token(BOT_TOKEN).build()

    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
    application.add_handler(CommandHandler("start", start))
    application.add_handler(CommandHandler("menu", show_main_menu))
    application.add_handler(CommandHandler("stop", handle_goodbye))

    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π —Å –∫–Ω–æ–ø–æ–∫ –º–µ–Ω—é
    application.add_handler(MessageHandler(filters.Regex("^üíº –£–∑–Ω–∞—Ç—å –æ –Ω–∞—à–∏—Ö —É—Å–ª—É–≥–∞—Ö$"), handle_services_menu))
    application.add_handler(MessageHandler(filters.Regex("^üîç –ü—Ä–∞–≤–æ–≤–æ–π –∞—É–¥–∏—Ç$"), handle_audit_details))
    application.add_handler(MessageHandler(filters.Regex("^‚öñÔ∏è –°—É–¥—ã –∏ –≥–æ—Å–æ—Ä–≥–∞–Ω—ã$"), lambda u, c: u.message.reply_text("–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–∏ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ –≤ —Å—É–¥–∞—Ö –∏ –≥–æ—Å–æ—Ä–≥–∞–Ω–∞—Ö. (–ó–∞–≥–ª—É—à–∫–∞)", reply_markup=ReplyKeyboardMarkup(BACK_KEYBOARD, resize_keyboard=True))))
    application.add_handler(MessageHandler(filters.Regex("^ü§ñ –õ–µ–≥–∞–ª—Ç–µ–∫$"), lambda u, c: u.message.reply_text("–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ª–µ–≥–∞–ª—Ç–µ–∫ —Ä–µ—à–µ–Ω–∏—è—Ö. (–ó–∞–≥–ª—É—à–∫–∞)", reply_markup=ReplyKeyboardMarkup(BACK_KEYBOARD, resize_keyboard=True))))
    application.add_handler(MessageHandler(filters.Regex("^üìû –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è$"), handle_consultation_request))
    application.add_handler(MessageHandler(filters.Regex("^üìÖ –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é$"), handle_consultation_request))
    application.add_handler(MessageHandler(filters.Regex("^‚ùì –£–∑–Ω–∞—Ç—å –æ —Å—Ç–∞—Ç—É—Å–µ –∑–∞–ø—Ä–æ—Å–∞$"), handle_request_status))
    application.add_handler(MessageHandler(filters.Regex("^üì¨ –î—Ä—É–≥–æ–µ.*$"), handle_other_question))
    application.add_handler(MessageHandler(filters.Regex("^üéÅ –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ$"), handle_special_offer))
    application.add_handler(MessageHandler(filters.Regex("^‚¨ÖÔ∏è –ù–∞–∑–∞–¥$"), handle_back))

    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —é–º–æ—Ä–∞ –∏ –æ–±—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
    humor_filters = filters.Regex("(?i)(–∫–∞–∫–æ–π.*–¥–µ–Ω—å|–º–æ–∂–Ω–æ.*–ø–∏—Ü—Ü|–ø–∏—Ü—Ü–∞.*–∑–∞–≤—Ç—Ä–∞–∫|–Ω–µ.*–ø–æ–ø–∞—Å—Ç—å.*–Ω–µ–ø—Ä–∏—è—Ç–Ω–æ—Å—Ç–∏)")
    application.add_handler(MessageHandler(humor_filters, handle_humor_or_questions))

    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
    application.add_handler(MessageHandler(filters.COMMAND, unknown_command))

    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–ø–æ—Å–ª–µ –≤—Å–µ—Ö —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤)
    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_humor_or_questions))

    # –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
    logger.info("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω...")
    application.run_polling(allowed_updates=Update.ALL_TYPES)


if __name__ == "__main__":
    main()
